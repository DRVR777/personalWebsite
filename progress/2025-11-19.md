# Progress Log - November 19, 2025

## Project Overview
**Goal:** Transform a Three.js website into a 3D explorable shop where products can be displayed on interactive stands.

## Current State

### âœ… Completed Features

#### 1. Display Stand System
- **Location:** `src/world/Museum.js`, `src/config/displays.js`
- **What it does:** 
  - Creates white pedestals (2x1x2 boxes) that act as product holders
  - Each stand has a unique ID (e.g., `'center-stand'`, `'left-stand'`)
  - Items are parented to stands (moving a stand automatically moves its item)
- **Configuration:** Edit `src/config/displays.js` to add/remove stands
  ```javascript
  { id: 'center-stand', x: 0, z: 0, item: 'tree', scale: 0.5 }
  ```

#### 2. Asset Loading System
- **Location:** `src/loaders/AssetManager.js`, `src/config/assets.js`
- **What it does:**
  - Centralized asset registry in `assets.js`
  - Loads `.glb` models with Draco compression
  - Caches assets for performance
- **How to add a model:**
  1. Place `.glb` file in `public/models/props/`
  2. Register in `assets.js`: `tree: '/models/props/tree.glb'`
  3. Reference in `displays.js`: `item: 'tree'`

#### 3. Developer Mode (Visual Editor)
- **Location:** `src/systems/Editor.js`
- **What it does:**
  - Toggle with **`** (backtick key)
  - Click on stands to select them
  - Drag colored arrows to move objects:
    - **Red** = X axis (left/right)
    - **Green** = Y axis (up/down)
    - **Blue** = Z axis (forward/back)
  - Press **Shift + E** to export positions to console
- **Architecture:**
  - Custom gizmo using `THREE.ArrowHelper` (TransformControls was buggy)
  - Raycasting for selection and drag detection
  - Plane-based dragging for smooth movement

#### 4. First-Person Controls
- **Location:** `src/systems/controls.js`
- **Controls:**
  - **WASD** = Move
  - **Mouse** = Look around
  - **Space** = Fly up
  - **Shift** = Fly down
- **Settings:** Configurable in `src/config/settings.js`
  - `moveSpeed: 5.0`
  - `sprintMultiplier: 2.5`

### ğŸ—ï¸ Project Structure
```
src/
â”œâ”€â”€ config/
â”‚   â”œâ”€â”€ assets.js       # Asset registry
â”‚   â”œâ”€â”€ displays.js     # Shop layout config
â”‚   â””â”€â”€ settings.js     # Global settings
â”œâ”€â”€ loaders/
â”‚   â””â”€â”€ AssetManager.js # Asset loading system
â”œâ”€â”€ systems/
â”‚   â”œâ”€â”€ camera.js
â”‚   â”œâ”€â”€ controls.js     # First-person movement
â”‚   â”œâ”€â”€ Editor.js       # Developer mode
â”‚   â”œâ”€â”€ lighting.js
â”‚   â”œâ”€â”€ renderer.js
â”‚   â””â”€â”€ scene.js
â”œâ”€â”€ world/
â”‚   â””â”€â”€ Museum.js       # Main 3D environment
â””â”€â”€ main.js             # App entry point
```

### ğŸ› Known Issues & Fixes Applied

1. **Tree Model Not Loading**
   - **Issue:** `ASSETS.props.tree` was undefined
   - **Fix:** Corrected path to `ASSETS.models.props.tree`

2. **Invisible Gizmo Arrows**
   - **Issue:** `TransformControls` not rendering
   - **Fix:** Replaced with custom `ArrowHelper` gizmo
   - Set `depthTest: false` and `renderOrder: 999` for visibility

3. **Spacebar Not Working**
   - **Issue:** Key mapping was checking for `'space'` instead of `' '`
   - **Fix:** Updated key handlers to use correct key value

4. **App Crash on Startup**
   - **Issue:** Trying to add `controls.yawObject` to scene
   - **Fix:** Removed line (FirstPersonControls manipulates camera directly)

### ğŸ“ How the System Works

#### Display Stand Lifecycle
1. **Initialization** (`Museum.load()`)
   - Reads `DISPLAYS` array from `displays.js`
   - Calls `createDisplayStand(id, x, z)` for each entry
   - Creates white box mesh at specified position
   - Stores in `Museum.displays` Map

2. **Asset Assignment**
   - If `item` is specified in config, calls `assignAssetToDisplay()`
   - Loads model using `AssetManager`
   - Parents model to stand mesh (`stand.add(model)`)
   - Positions model at local `(0, 0.5, 0)` (top of stand)

3. **Developer Mode Editing**
   - User selects stand â†’ Gizmo appears
   - User drags arrow â†’ Stand position updates
   - Child item moves automatically (due to parenting)
   - Export generates new config code

### ğŸ”„ Workflow for Adding Products

1. **Export model from Blender** as `.glb`
2. **Place file** in `public/models/props/`
3. **Register in** `src/config/assets.js`:
   ```javascript
   props: {
     myProduct: '/models/props/my-product.glb'
   }
   ```
4. **Add to shop** in `src/config/displays.js`:
   ```javascript
   { id: 'new-stand', x: 5, z: 5, item: 'myProduct', scale: 1 }
   ```
5. **Refresh browser** â†’ Product appears

### ğŸ¯ Next Steps (Not Implemented)

- [ ] LocalStorage auto-save for Dev Mode
- [ ] Poster/texture attachment to stands
- [ ] Rotation controls in Dev Mode
- [ ] Multiple item types (not just models)
- [ ] Shop-specific `Shop.js` world class
- [ ] Product interaction (click to view details)

### ğŸ› ï¸ Dependencies
- `three@0.181.0` - 3D engine
- `gsap@3.13.0` - Animations
- `lil-gui@0.21.0` - Debug UI
- `vite@7.1.7` - Dev server

---

**Last Updated:** November 19, 2025, 1:25 AM  
**Status:** Fully functional display system with visual editor
